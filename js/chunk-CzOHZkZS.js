import{u as e,b as l}from"./chunk-DMoODoeY.js";import{b as s,s as a,r as t,h as o,o as n,e as i,f as r,z as d,j as p,k as c,F as b,a4 as m,a5 as u,a6 as g}from"./chunk-Dfru-Ds3.js";import{r as f}from"./chunk-Cv_h2SVa.js";import{_ as x}from"./chunk-DLBqbsJ1.js";const h={class:"modal-box"},y={class:"modal-action"},k={method:"dialog",class:"flex gap-3"},_={class:"modal-box"},v={class:"modal-action"},A={method:"dialog",class:"flex gap-3"},C={class:"min-w-1000px"},j={class:"flex gap-3"},N={class:""},z={for:"explore"},P={class:"tooltip tooltip-bottom","data-tip":"上传修改好的excel文件"},S=s({__name:"PersonAll",setup(s){const S=e().personConfig,{getAllPersonList:w,getAlreadyPersonList:W}=a(S),D=t(),T=t(),J=async e=>{let s=await f(e.target.files[0]),a=m(s,{type:"binary",cellDates:!0}),t=a.Sheets[a.SheetNames[0]];const o=u.sheet_to_json(t),n=l(o);S.resetPerson(),S.addNotPersonList(n)},O=()=>{let e=JSON.parse(JSON.stringify(w.value));for(let s=0;s<e.length;s++)delete e[s].x,delete e[s].y,delete e[s].id,delete e[s].createTime,delete e[s].updateTime,delete e[s].prizeId,e[s].isWin?e[s].isWin="是":e[s].isWin="否",e[s].prizeTime=e[s].prizeTime.join(","),e[s].prizeName=e[s].prizeName.join(",");let l=JSON.stringify(e);if(l=l.replaceAll(/uid/g,"编号").replaceAll(/isWin/g,"是否中奖").replaceAll(/department/g,"部门").replaceAll(/name/g,"姓名").replaceAll(/identity/g,"身份").replaceAll(/prizeName/g,"获奖").replaceAll(/prizeTime/g,"获奖时间"),e=JSON.parse(l),e.length>0){const l=u.json_to_sheet(e),s=u.book_new();u.book_append_sheet(s,l,"Sheet1"),g(s,"data.xlsx")}},L=()=>{S.resetAlreadyPerson()},M=()=>{S.deleteAllPerson()},F=[{label:"编号",props:"uid"},{label:"姓名",props:"name"},{label:"部门",props:"department"},{label:"身份",props:"identity"},{label:"是否已中奖",props:"isWin",formatValue:e=>e.isWin?"是":"否"},{label:"操作",actions:[{label:"删除",type:"btn-error",onClick:e=>{(e=>{S.deletePerson(e)})(e)}}]}];return o((()=>{})),(e,l)=>(n(),i(b,null,[r("dialog",{id:"my_modal_1",ref_key:"resetDataDialog",ref:D,class:"border-none modal"},[r("div",h,[l[4]||(l[4]=r("h3",{class:"text-lg font-bold"},"提示!",-1)),l[5]||(l[5]=r("p",{class:"py-4"},"该操作会清空人员中奖信息，是否继续？",-1)),r("div",y,[r("form",k,[r("button",{class:"btn",onClick:l[0]||(l[0]=e=>D.value.close())},"取消"),r("button",{class:"btn",onClick:L},"确定")])])])],512),r("dialog",{id:"my_modal_1",ref_key:"delAllDataDialog",ref:T,class:"border-none modal"},[r("div",_,[l[6]||(l[6]=r("h3",{class:"text-lg font-bold"},"提示!",-1)),l[7]||(l[7]=r("p",{class:"py-4"},"该操作会删除所有人员数据，是否继续？",-1)),r("div",v,[r("form",A,[r("button",{class:"btn",onClick:l[1]||(l[1]=e=>T.value.close())},"取消"),r("button",{class:"btn",onClick:M},"确定")])])])],512),r("div",C,[l[12]||(l[12]=r("h2",null,"人员管理",-1)),r("div",j,[r("button",{class:"btn btn-error btn-sm",onClick:l[2]||(l[2]=e=>T.value.showModal())},"全部删除"),l[11]||(l[11]=r("div",{class:"tooltip tooltip-bottom","data-tip":"下载文件后，请在excel中填写数据，并保存为xlsx格式"},[r("a",{class:"no-underline btn btn-secondary btn-sm",download:"人口登记表.xlsx",target:"_blank",href:"/log-lottery/人口登记表.xlsx"},"下载模板")],-1)),r("div",N,[r("label",z,[r("div",P,[r("input",{type:"file",class:"",id:"explore",style:{display:"none"},onChange:J,accept:".xlsx,.xls"},null,32),l[8]||(l[8]=r("span",{class:"btn btn-primary btn-sm"},"导入人员数据",-1))])])]),r("button",{class:"btn btn-error btn-sm",onClick:l[3]||(l[3]=e=>D.value.showModal())},"重置人员数据"),r("button",{class:"btn btn-accent btn-sm",onClick:O},"导出结果"),r("div",null,[l[9]||(l[9]=r("span",null,"中奖人数：",-1)),r("span",null,d(p(W).length),1),l[10]||(l[10]=r("span",null," / ",-1)),r("span",null,d(p(w).length),1)])]),c(x,{tableColumns:F,data:p(w)},null,8,["data"])])],64))}});export{S as default};
