import{u as e,d as l,_ as s}from"./chunk-DMoODoeY.js";import{b as a,l as t,s as n,r as o,h as u,w as i,o as c,e as r,f as d,F as p,y as b,A as m,j as f,k as v,B as x,C,E as h,n as w,z as g,D as k}from"./chunk-Dfru-Ds3.js";const y={class:"p-0 m-0"},U={class:"max-w-xs mb-10 form-control"},z={class:"flex flex-col items-center gap-2 pt-5"},L={class:"w-1/2 max-w-xs mb-10 form-control"},j=["onUpdate:modelValue"],P={class:"w-1/2 max-w-xs mb-10 form-control"},A=["checked","onChange"],V={class:"w-1/2 max-w-xs mb-10 form-control"},D=["onUpdate:modelValue","onChange"],S=["data-tip"],O=["value","max"],_={class:"w-1/2 max-w-xs mb-10 form-control"},B=["checked","onChange"],I={class:"w-full max-w-xs mb-10 form-control"},M=["onUpdate:modelValue"],N={key:0,value:{id:"",name:"",url:""}},q=["value"],E={key:0,class:"w-full max-w-xs mb-10 form-control"},F=["onClick"],T={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},$=["data-tip"],G={key:1,class:"btn btn-secondary btn-xs"},H={class:"w-full max-w-xs mb-10 form-control"},J={class:"flex gap-2"},K=["onClick"],Q=a({__name:"PrizeConfig",setup(a){const Q=t.createInstance({name:"imgStore"}),R=e().prizeConfig,W=e().globalConfig,{getPrizeConfig:X,getCurrentPrize:Y}=n(R),{getImageList:Z}=n(W),ee=o(X),le=o([]),se=o(),ae=()=>{const e={id:(new Date).getTime().toString(),name:"奖项",sort:0,isAll:!1,count:1,isUsedCount:0,picture:{id:"",name:"",url:""},separateCount:{enable:!1,countList:[]},desc:"",isUsed:!1,isShow:!0,frequency:1};R.addPrizeConfig(e)},te=e=>{se.value.separateCount.countList=e,se.value=null},ne=()=>{R.resetDefault()},oe=(e,l)=>{const s=ee.value.indexOf(e);1==l?(ee.value.splice(s,1),ee.value.splice(s-1,0,e)):(ee.value.splice(s,1),ee.value.splice(s+1,0,e))},ue=async()=>{await R.deleteAllPrizeConfig()};return u((()=>{(async()=>{(await Q.keys()).length>0&&Q.iterate(((e,l)=>{le.value.push({key:l,value:e})}))})()})),i((()=>ee.value),(e=>{R.setPrizeConfig(e)}),{deep:!0}),(e,a)=>{var t,n;const o=s;return c(),r("div",null,[a[8]||(a[8]=d("h2",null,"奖项配置",-1)),d("div",{class:"flex w-full gap-3"},[d("button",{class:"btn btn-info btn-sm",onClick:ae},"添加"),d("button",{class:"btn btn-info btn-sm",onClick:ne},"默认列表"),d("button",{class:"btn btn-error btn-sm",onClick:ue},"全部删除")]),a[9]||(a[9]=d("div",{role:"alert",class:"w-full my-4 alert alert-info"},[d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 stroke-current shrink-0"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),d("span",null,"进行操作可能会重置数据，请谨慎操作")],-1)),d("ul",y,[(c(!0),r(p,null,b(ee.value,(e=>(c(),r("li",{key:e.id,class:m(["flex gap-10",f(Y).id==e.id?"border-1 border-dotted rounded-xl":null])},[d("label",U,[d("div",z,[v(o,{class:m(["cursor-pointer hover:text-blue-400",0==ee.value.indexOf(e)?"opacity-0 cursor-default":""]),name:"up",onClick:l=>oe(e,1)},null,8,["class","onClick"]),v(o,{class:m(["cursor-pointer hover:text-blue-400",ee.value.indexOf(e)==ee.value.length-1?"opacity-0 cursor-default":""]),name:"down",onClick:l=>oe(e,0)},null,8,["onClick","class"])])]),d("label",L,[a[0]||(a[0]=d("div",{class:"label"},[d("span",{class:"label-text"},"名称")],-1)),x(d("input",{type:"text","onUpdate:modelValue":l=>e.name=l,placeholder:"名称",class:"w-full max-w-xs input-sm input input-bordered"},null,8,j),[[C,e.name]])]),d("label",P,[a[1]||(a[1]=d("div",{class:"label"},[d("span",{class:"label-text"},"全员参加")],-1)),d("input",{type:"checkbox",checked:e.isAll,onChange:l=>e.isAll=!e.isAll,class:"mt-2 border-solid checkbox checkbox-secondary border-1"},null,40,A)]),d("label",V,[a[2]||(a[2]=d("div",{class:"label"},[d("span",{class:"label-text"},"抽奖人数")],-1)),x(d("input",{type:"number","onUpdate:modelValue":l=>e.count=l,placeholder:"获奖人数",onChange:l=>(e=>{let l=-1;for(let s=0;s<ee.value.length;s++)if(ee.value[s].id==e.id){l=s;break}l>-1&&(ee.value[l].separateCount.countList=[],ee.value[l].isUsed?ee.value[l].isUsedCount=ee.value[l].count:ee.value[l].isUsedCount=0)})(e),class:"w-full max-w-xs p-0 m-0 input-sm input input-bordered"},null,40,D),[[C,e.count]]),d("div",{class:"tooltip tooltip-bottom","data-tip":"已抽取:"+e.isUsedCount+"/"+e.count},[d("progress",{class:"w-full progress",value:e.isUsedCount,max:e.count},null,8,O)],8,S)]),d("label",_,[a[3]||(a[3]=d("div",{class:"label"},[d("span",{class:"label-text"},"已抽取")],-1)),d("input",{type:"checkbox",checked:e.isUsed,onChange:l=>(e=>{e.isUsed?e.isUsedCount=0:e.isUsedCount=e.count,e.separateCount.countList=[],e.isUsed=!e.isUsed})(e),class:"mt-2 border-solid checkbox checkbox-secondary border-1"},null,40,B)]),d("label",I,[a[5]||(a[5]=d("div",{class:"label"},[d("span",{class:"label-text"},"图片")],-1)),x(d("select",{class:"w-full max-w-xs select select-warning select-sm","onUpdate:modelValue":l=>e.picture=l},[e.picture.id?(c(),r("option",N,"❌")):w("",!0),a[4]||(a[4]=d("option",{disabled:"",selected:""},"选择一张图片",-1)),(c(!0),r(p,null,b(f(Z),(e=>(c(),r("option",{key:e.id,value:e},g(e.name),9,q)))),128))],8,M),[[h,e.picture]])]),e.separateCount?(c(),r("label",E,[a[6]||(a[6]=d("div",{class:"label"},[d("span",{class:"label-text"},"单次抽取个数")],-1)),d("div",{class:"flex justify-start w-full h-full",onClick:l=>(e=>{se.value=e,se.value.isUsedCount=0,se.value.isUsed=!1,se.value.separateCount.countList.length>1||(se.value.separateCount={enable:!0,countList:[{id:"0",count:e.count,isUsedCount:0}]})})(e)},[e.separateCount.countList.length?(c(),r("ul",T,[(c(!0),r(p,null,b(e.separateCount.countList,(e=>(c(),r("li",{class:"relative flex items-center justify-center w-8 h-8 bg-slate-600/60 separated",key:e.id},[d("div",{class:"flex items-center justify-center w-full h-full tooltip","data-tip":"已抽取:"+e.isUsedCount+"/"+e.count},[d("div",{class:"absolute left-0 z-50 h-full bg-blue-300/80",style:k(`width:${100*e.isUsedCount/e.count}%`)},null,4),d("span",null,g(e.count),1)],8,$)])))),128))])):(c(),r("button",G,"设置"))],8,F)])):w("",!0),d("label",H,[a[7]||(a[7]=d("div",{class:"label"},[d("span",{class:"label-text"},"操作")],-1)),d("div",J,[d("button",{class:"btn btn-error btn-sm",onClick:l=>(e=>{R.deletePrizeConfig(e.id)})(e)},"删除",8,K)])])],2)))),128))]),v(l,{totalNumber:null==(t=se.value)?void 0:t.count,"separated-number":null==(n=se.value)?void 0:n.separateCount.countList,onSubmitData:te},null,8,["totalNumber","separated-number"])])}}});export{Q as default};
